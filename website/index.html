<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <title>Codenames</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  </head>
  <body class="booting">
    <!-- Auth Loading Screen (shown during account verification) -->
    <div class="auth-loading-screen" id="auth-loading-screen">
      <div class="auth-loading-content">
        <!-- Desktop Animation: Animated grid of cards -->
        <div class="auth-loading-desktop">
          <div class="auth-loading-grid">
            <div class="auth-loading-card" style="--delay: 0"></div>
            <div class="auth-loading-card" style="--delay: 1"></div>
            <div class="auth-loading-card" style="--delay: 2"></div>
            <div class="auth-loading-card" style="--delay: 3"></div>
            <div class="auth-loading-card accent" style="--delay: 4"></div>
            <div class="auth-loading-card" style="--delay: 5"></div>
            <div class="auth-loading-card" style="--delay: 6"></div>
            <div class="auth-loading-card" style="--delay: 7"></div>
            <div class="auth-loading-card" style="--delay: 8"></div>
          </div>
          <div class="auth-loading-text">
            <span class="auth-loading-title">CODENAMES</span>
            <span class="auth-loading-subtitle"><span id="auth-loading-message-desktop">Loading</span><span class="auth-dots"><span>.</span><span>.</span><span>.</span></span></span>
          </div>
        </div>

        <!-- Mobile Animation: Pulsing logo with orbit -->
        <div class="auth-loading-mobile">
          <div class="auth-mobile-orbit">
            <div class="auth-orbit-ring"></div>
            <div class="auth-orbit-dot"></div>
            <div class="auth-mobile-logo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="7" height="7" rx="1" class="auth-rect auth-rect-1"/>
                <rect x="14" y="3" width="7" height="7" rx="1" class="auth-rect auth-rect-2"/>
                <rect x="3" y="14" width="7" height="7" rx="1" class="auth-rect auth-rect-3"/>
                <rect x="14" y="14" width="7" height="7" rx="1" class="auth-rect auth-rect-4"/>
              </svg>
            </div>
          </div>
          <div class="auth-mobile-text">
            <span class="auth-loading-title">CODENAMES</span>
            <span class="auth-loading-subtitle"><span id="auth-loading-message-mobile">Loading</span><span class="auth-dots"><span>.</span><span>.</span><span>.</span></span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Confirm Dialog (Continue as X) -->
    <div class="confirm-dialog-backdrop hidden" id="confirm-dialog-backdrop"></div>
    <div class="confirm-dialog hidden" id="confirm-dialog" role="dialog" aria-modal="true" aria-labelledby="confirm-dialog-title">
      <div class="confirm-dialog-card">
        <div class="confirm-dialog-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4"/>
            <path d="M12 8h.01"/>
          </svg>
        </div>
        <h2 class="confirm-dialog-title" id="confirm-dialog-title">Continue as this player?</h2>
        <p class="confirm-dialog-message" id="confirm-dialog-message">This name is already taken. Continue to log in as "<span id="confirm-dialog-name">‚Äî</span>"?</p>
        <div class="confirm-dialog-actions">
          <button type="button" class="btn" id="confirm-dialog-cancel">Cancel</button>
          <button type="button" class="btn primary" id="confirm-dialog-ok">Continue</button>
        </div>
      </div>
    </div>

    <!-- System Dialog (used for account corruption / notices) -->
    <div class="confirm-dialog-backdrop hidden" id="system-dialog-backdrop"></div>
    <div class="confirm-dialog hidden" id="system-dialog" role="dialog" aria-modal="true" aria-labelledby="system-dialog-title">
      <div class="confirm-dialog-card">
        <div class="confirm-dialog-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4"/>
            <path d="M12 8h.01"/>
          </svg>
        </div>
        <h2 class="confirm-dialog-title" id="system-dialog-title">Notice</h2>
        <p class="confirm-dialog-message" id="system-dialog-message"></p>
        <div class="confirm-dialog-actions" style="justify-content:flex-end;">
          <button type="button" class="btn primary" id="system-dialog-ok">OK</button>
        </div>
      </div>
    </div>

    <!-- Password Prompt Dialog (no browser prompt) -->
    <div class="confirm-dialog-backdrop hidden" id="password-dialog-backdrop"></div>
    <div class="confirm-dialog hidden" id="password-dialog" role="dialog" aria-modal="true" aria-labelledby="password-dialog-title">
      <div class="confirm-dialog-card">
        <div class="confirm-dialog-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <h2 class="confirm-dialog-title" id="password-dialog-title">Confirm password</h2>
        <p class="confirm-dialog-message" id="password-dialog-message">Enter your password to continue.</p>
        <div class="pw-field modal-pw-field">
          <input type="password" class="input auth-input" id="password-dialog-input" placeholder="Password" autocomplete="current-password">
          <button class="pw-toggle" id="password-dialog-toggle" type="button" aria-label="Show password" title="Show password">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
        <div class="confirm-dialog-actions">
          <button type="button" class="btn" id="password-dialog-cancel">Cancel</button>
          <button type="button" class="btn primary" id="password-dialog-ok">Continue</button>
        </div>
      </div>
    </div>

    <div class="app">
      <!-- Auth Screen (sign in / create account) -->
      <div class="auth-screen" id="auth-screen" aria-label="Sign in">
        <div class="auth-card">
          <div class="auth-hero">
            <h1 class="auth-title">CODENAMES</h1>
            <p class="auth-subtitle">Sign in to play</p>
          </div>

          <div class="auth-tabs" role="tablist" aria-label="Account">
            <button type="button" class="btn primary" id="launch-show-login" style="flex:1;" role="tab" aria-selected="true">Log in</button>
            <button type="button" class="btn" id="launch-show-create" style="flex:1;" role="tab" aria-selected="false">Create account</button>
          </div>

          <form id="launch-login-form" class="form auth-form" autocomplete="on">
            <input type="text" id="launch-username-login" class="input auth-input" placeholder="Username" autocapitalize="off" autocomplete="username" required>
            <div class="pw-field">
              <input type="password" id="launch-password-login" class="input auth-input" placeholder="Password" autocomplete="current-password" required>
              <button class="pw-toggle" id="pw-toggle-login" type="button" aria-label="Show password" title="Show password">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
            </div>
            <button type="submit" class="btn primary auth-submit" id="launch-login-btn">Log in</button>
            <div class="hint auth-hint" id="launch-name-hint"></div>
          </form>

          <form id="launch-create-form" class="form auth-form" autocomplete="on" style="display:none;">
            <input type="text" id="launch-username-create" class="input auth-input" placeholder="Username" autocapitalize="off" autocomplete="username" required>
            <div class="pw-field">
              <input type="password" id="launch-password-create" class="input auth-input" placeholder="Password" autocomplete="new-password" required>
              <button class="pw-toggle" id="pw-toggle-create" type="button" aria-label="Show password" title="Show password">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
            </div>
            <button type="submit" class="btn primary auth-submit" id="launch-create-btn">Create account</button>
            <div class="hint auth-hint" id="launch-name-hint-create"></div>
            <div class="hint auth-note">Usernames: 3‚Äì20 chars (a‚Äìz, 0‚Äì9, _)</div>
          </form>

          <button class="btn ghost auth-online-btn" id="auth-whos-online-btn" type="button">
            Who's Online <span class="auth-online-count" id="auth-online-count">0</span>
          </button>
        </div>
      </div>

      <!-- Launch Screen (choose mode after sign-in) -->
      <div class="launch-screen" id="launch-screen" aria-label="Choose play mode">
        <div class="launch-card">
          <div class="launch-hero">
            <h1 class="launch-h1">Play Codenames</h1>
            <p class="launch-sub">Choose how you want to play</p>
          </div>

          <div class="launch-signed-as" id="launch-signed-as">Signed in as ‚Äî</div>

          <div class="launch-mode-row">
            <button class="mode-card" id="launch-quick-play" type="button">
              <div class="mode-card-icon">‚ö°</div>
              <div class="mode-card-title">Quick Play</div>
              <div class="mode-card-desc">Jump into a casual live game.</div>
            </button>

            <button class="mode-card" id="launch-tournament" type="button">
              <div class="mode-card-icon">üèÜ</div>
              <div class="mode-card-title">Tournament</div>
              <div class="mode-card-desc">Challenge teams and climb ranks.</div>
            </button>
          </div>
        </div>
      </div>

      <!-- App Header (desktop + mobile) -->
      <header class="app-header">
        <div class="logo">CODENAMES</div>

        <div class="header-user">
          <div class="header-user-stack">
            <button class="online-counter-btn" id="header-name-pill" type="button">
              <span class="name-icon">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="8" r="5"/>
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                </svg>
              </span>
              <span class="online-count" id="user-name-display">‚Äî</span>
            </button>
            <button class="online-counter-btn" id="header-team-pill" type="button">
              <span class="team-icon">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
              </span>
              <span class="online-count team-accent" id="user-team-display">No team</span>
            </button>
            <button class="online-counter-btn" id="online-counter-btn" type="button">
              <span class="online-dot"></span>
              <span class="online-count" id="online-count">0</span>
              <span class="online-label">online</span>
            </button>
          </div>
          <input class="input header-user-input" id="user-name-input" type="text" placeholder="Your name" style="display:none;" />
          
          <button class="icon-btn header-icon-btn" id="header-chat-btn" type="button" aria-label="Messages">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"></path>
            </svg>
            <span class="badge icon-badge" id="badge-header-chat" aria-label="Unread messages" style="display:none;"></span>
          </button>

          <button class="settings-gear-btn" id="settings-gear-btn" type="button" aria-label="Settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
              <line x1="4" y1="6" x2="20" y2="6"></line>
              <circle cx="9" cy="6" r="2" fill="currentColor" stroke="none"></circle>
              <line x1="4" y1="12" x2="20" y2="12"></line>
              <circle cx="15" cy="12" r="2" fill="currentColor" stroke="none"></circle>
              <line x1="4" y1="18" x2="20" y2="18"></line>
              <circle cx="11" cy="18" r="2" fill="currentColor" stroke="none"></circle>
            </svg>
          </button>
        </div>
      </header>

      <!-- Desktop Tabs -->
      <nav class="desktop-tabs" aria-label="Primary">
        <button class="tab" data-panel="panel-home" type="button">Home</button>
        <button class="tab" data-panel="panel-teams" type="button">Teams</button>
        <button class="tab" data-panel="panel-players" type="button">Players</button>
        <button class="tab" data-panel="panel-myteam" type="button">
          My Team
          <span class="badge tab-badge" id="badge-myteam-desktop" aria-label="Team notifications" style="display:none;"></span>
        </button>
        <button class="tab active" data-panel="panel-game" type="button">
          Play
          <span class="badge tab-badge" id="badge-game-desktop" aria-label="Active games" style="display:none;"></span>
        </button>
      </nav>

      <main class="main-content">
        <!-- Home -->
        <section class="panel panel-info" id="panel-home">
          <div class="panel-inner">
            <div class="home-hero">
              <h1 class="home-title">Codenames Tournament</h1>
              <p class="subtitle">Create a team or request to join one.</p>
            </div>

            <div class="spots-display">
              <div class="spots-number" id="spots-left">8</div>
              <div class="spots-label">team slots left</div>
            </div>

            <div class="info-stats">
              <div class="info-stat">
                <span class="val" id="team-count">0/8</span>
                <span class="lbl">Full Teams</span>
              </div>
              <div class="info-stat">
                <span class="val">3+</span>
                <span class="lbl">Per Team</span>
              </div>
              <div class="info-stat">
                <span class="val" id="players-count">0</span>
                <span class="lbl">Players</span>
              </div>
            </div>

            <!-- Sleek name dock (bottom on mobile, top-right on desktop header) -->
            <div class="name-dock" id="name-card">
              <form id="name-form" class="form name-dock-form">
                <label class="field" style="margin:0;">
                  <span class="label">Your name</span>
                  <input type="text" id="name-input" class="input" placeholder="Name" required>
                </label>
                <div class="form-actions" style="margin:0;">
                  <button type="submit" class="btn primary">Sign In</button>
                  <span class="hint" id="name-hint"></span>
                </div>
              </form>

              <div id="name-saved" class="name-dock-saved" style="display:none;">
                <div class="name-saved-stack">
                  <div class="name-dock-value" id="name-saved-display" title="Double click to edit">‚Äî</div>
                  <input class="input" id="name-saved-input" type="text" style="display:none;" />
                  <button class="btn logout" id="logout-btn" type="button">Log out</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Teams Page -->
        <section class="panel panel-teams" id="panel-teams">
          <div class="panel-inner">
            <h2>Teams <span class="pill" id="team-count-pill">0/8</span></h2>
            <p class="subtitle small">Teams need 3+ members to count. Request to join any team.</p>
            <span class="hint" id="teams-hint"></span>
            <div class="teams-list" id="teams-list"></div>
          </div>
        </section>

        <!-- Players Page -->
        <section class="panel panel-players" id="panel-players">
          <div class="panel-inner">
            <h2>Players</h2>
            <p class="subtitle small">Everyone who has entered their name. Anyone on a team can invite players (including people already on teams).</p>
            <span class="hint" id="players-hint"></span>
            <div class="players-directory" id="players-list"></div>
          </div>
        </section>

        <!-- My Team Page -->
        <section class="panel panel-register" id="panel-myteam">
          <div class="panel-inner">
            <h2>My Team</h2>
            <p class="subtitle small" id="myteam-subtitle">Create a team or manage your current team.</p>

            <div class="stack">
              <button class="btn" id="join-team-btn" type="button" style="display:none;">Join a team</button>
              <button class="btn primary" id="open-create-team" type="button">Create a team</button>
              <button class="btn invites-btn" id="open-invites-top" type="button">Invites</button>

              <div class="team-card my-team" id="myteam-card" style="display:none;">
                <div class="team-summary no-details">
                  <div class="team-left">
                    <div class="team-rank">#</div>
                    <div class="team-name-wrap">
                      <span class="team-name editable team-accent" id="myteam-name" title="Double click to rename"></span>
                      <input class="team-name-input input" id="myteam-name-input" type="text" style="display:none;" />
                    </div>
                  </div>
                  <div class="team-right">
                    <span class="meta" id="myteam-size">0/4</span>
                  </div>
                </div>

                <div class="team-body">
                  <div class="team-section-title">Teammates</div>
                  <div class="players-list" id="myteam-members"></div>
                  <div class="owner-actions-row" id="myteam-actions"></div>

                  <div class="team-color-row" id="team-color-row" style="display:none;">
                    <div class="team-color-label">Team color</div>
                    <input class="team-color-input" id="team-color-input" type="color" value="#3b82f6" aria-label="Team color" />
                  </div>

                  <div class="myteam-footer">
                    <button class="btn small" id="open-requests" type="button" style="display:none;">Requests</button>
                    <button class="btn invites-btn" id="open-invites" type="button" style="display:none;">Invites</button>
                    <button class="btn danger" id="leave-or-delete" type="button" style="display:none;">Leave team</button>
                  </div>
                </div>
              </div>

              <!-- Invites (moved below My Team + Requests) -->
              <div class="team-card invites" id="invites-card" style="display:none;">
                <div class="team-body">
                  <div class="team-section-title">Invites</div>
                  <div id="invites-list"></div>
                  <div class="hint" id="invites-hint" style="margin-top:10px;"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- Game Page -->
        <section class="panel panel-game active" id="panel-game">
          <div class="panel-inner">
            <!-- Mode Selection Screen -->
            <div id="play-mode-select">
              <h2>Play Codenames</h2>
              <p class="subtitle small">Choose how you want to play</p>

              <div class="mode-cards">
                <button class="mode-card" id="select-quick-play" type="button">
                  <div class="mode-card-icon">‚ö°</div>
                  <div class="mode-card-title">Quick Play</div>
                  <div class="mode-card-desc">Jump into a casual game. Pick your team color, customize settings, and play instantly.</div>
                </button>

                <button class="mode-card" id="select-tournament" type="button">
                  <div class="mode-card-icon">üèÜ</div>
                  <div class="mode-card-title">Tournament</div>
                  <div class="mode-card-desc">Competitive team-based play. Challenge other teams and climb the ranks.</div>
                </button>
              </div>

              <!-- Active Games to Spectate -->
              <div class="game-section" id="spectate-games-section" style="display:none;">
                <div class="game-section-title">Live Games</div>
                <div class="active-games-list" id="spectate-games-list"></div>
              </div>
            </div>

            <!-- Quick Play Lobby -->
            <div id="quick-play-lobby" style="display:none;">
              <div class="lobby-header">
                <h2>Quick Play</h2>
              </div>

              <!-- Player Name Check -->
              <div class="lobby-name-check" id="quick-name-check" style="display:none;">
                <div class="hint">Enter your name on the Home tab to play.</div>
              </div>

              <!-- Quick Play Setup -->
              <div class="quick-setup" id="quick-setup">
                <div class="quick-lobby-card">
                  <div class="quick-lobby-top">
                    <div class="setup-title" style="margin:0;">Lobby</div>
                  </div><div class="quick-lobby-layout">
                    <div class="quick-team-col red selectable" id="quick-red-col" role="button" tabindex="0" aria-label="Join Red team">
                      <div class="quick-team-head">
                        <span class="quick-team-dot red"></span>
                        <span class="quick-team-title">Red</span>
                        <span class="quick-team-count" id="quick-red-count">0</span>
                      </div>
                      <div class="quick-team-status" id="quick-red-status"></div>
                      <div class="quick-role-lists">
                        <div class="quick-role-section">
                          <div class="quick-role-title quick-seat-choice spymaster" id="quick-red-seat-spymaster" role="button" tabindex="0" aria-label="Join Red as Spymaster">Spymasters <button class="ai-add-btn" id="ai-add-red-spymaster" type="button" title="Add AI Spymaster" onclick="event.stopPropagation(); openAIModal('red','spymaster')">+AI</button></div>
                          <div class="quick-team-list" id="quick-red-spymaster-list"></div>
                        </div>
                        <div class="quick-role-divider" aria-hidden="true"></div>
                        <div class="quick-role-section">
                          <div class="quick-role-title quick-seat-choice operative" id="quick-red-seat-operative" role="button" tabindex="0" aria-label="Join Red as Operative">Operatives <button class="ai-add-btn" id="ai-add-red-operative" type="button" title="Add AI Operative" onclick="event.stopPropagation(); openAIModal('red','operative')">+AI</button></div>
                          <div class="quick-team-list" id="quick-red-operative-list"></div>
                        </div>
                      </div>
                    </div>

                    <div class="quick-team-col spectator selectable" id="quick-seat-switcher" role="button" tabindex="0" aria-label="Switch role (Red, Spectator, Blue)">
                      <div class="quick-team-head">
                        <span class="quick-team-dot spectator"></span>
                        <span class="quick-team-title">Spectators</span>
                        <span class="quick-team-count" id="quick-spec-count">0</span>
                      </div>
                      <div class="quick-team-list" id="quick-spec-list"></div>
                    </div>

                    <div class="quick-team-col blue selectable" id="quick-blue-col" role="button" tabindex="0" aria-label="Join Blue team">
                      <div class="quick-team-head">
                        <span class="quick-team-dot blue"></span>
                        <span class="quick-team-title">Blue</span>
                        <span class="quick-team-count" id="quick-blue-count">0</span>
                      </div>
                      <div class="quick-team-status" id="quick-blue-status"></div>
                      <div class="quick-role-lists">
                        <div class="quick-role-section">
                          <div class="quick-role-title quick-seat-choice spymaster" id="quick-blue-seat-spymaster" role="button" tabindex="0" aria-label="Join Blue as Spymaster">Spymasters <button class="ai-add-btn" id="ai-add-blue-spymaster" type="button" title="Add AI Spymaster" onclick="event.stopPropagation(); openAIModal('blue','spymaster')">+AI</button></div>
                          <div class="quick-team-list" id="quick-blue-spymaster-list"></div>
                        </div>
                        <div class="quick-role-divider" aria-hidden="true"></div>
                        <div class="quick-role-section">
                          <div class="quick-role-title quick-seat-choice operative" id="quick-blue-seat-operative" role="button" tabindex="0" aria-label="Join Blue as Operative">Operatives <button class="ai-add-btn" id="ai-add-blue-operative" type="button" title="Add AI Operative" onclick="event.stopPropagation(); openAIModal('blue','operative')">+AI</button></div>
                          <div class="quick-team-list" id="quick-blue-operative-list"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Lobby controls (moved out of the middle column) -->
                <div class="quick-lobby-controls">
                  <div class="quick-lobby-status" id="quick-lobby-status"></div>
                  <div class="quick-rules-bar" id="quick-rules-bar" aria-live="polite">
                    <div class="quick-rules-summary" id="quick-rules-summary">
                      <span class="qp-rules-badge" id="quick-rules-badge">Rules</span>
                      <span class="qp-rules-text" id="quick-rules-text">Rules: ‚Äî</span>
                    </div>
                    <div class="quick-rules-actions">
                      <button class="btn small qp-settings-open" id="quick-settings-btn" type="button">Settings</button>                    </div>
                  </div>
                  <div class="quick-lobby-actions">
                    <button class="btn primary" id="quick-ready-btn" type="button" disabled>Ready Up</button>
                    <button class="btn" id="quick-leave-btn" type="button" disabled>Leave</button>
                  </div>
                  <div class="hint" id="quick-lobby-hint" style="margin-top:10px;"></div>
                </div>

                <!-- Settings modal -->
                <div class="modal" id="quick-settings-modal" aria-hidden="true" style="display:none;">
                  <div class="modal-backdrop" id="quick-settings-backdrop"></div>
                  <div class="modal-card" role="dialog" aria-modal="true" aria-label="Quick Play Settings">
                    <div class="modal-head">
                      <div class="modal-title">Quick Play Settings</div>
                      <button class="icon-btn" id="quick-settings-close" type="button" aria-label="Close settings">‚úï</button>
                    </div>

                    <div class="modal-body">
                      <div class="settings-grid qp-settings-grid">
                        <label class="setting-row qp-setting" data-accent="deck">
                          <span class="setting-label">Word deck</span>
                          <select class="input setting-select" id="qp-deck-select" aria-label="Word deck">
                            <option value="standard" selected>Standard</option>
                            <option value="family">Family</option>
                            <option value="pop">Pop</option>
                            <option value="sports">Sports</option>
                            <option value="tech">Tech</option>
                          </select>
                          <input type="hidden" id="qp-deck" value="standard" />
                        </label>

                        <label class="setting-row qp-setting" data-accent="black">
                          <span class="setting-label">Assassin (black) cards</span>
                          <select class="input setting-select" id="qp-black-cards">
                            <option value="1" selected>1 (standard)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                          </select>
                        </label>

                        <label class="setting-row qp-setting" data-accent="clue">
                          <span class="setting-label">Spymaster clue timer</span>
                          <select class="input setting-select" id="qp-clue-timer">
                            <option value="0" selected>‚àû (no limit)</option>
                            <option value="30">30 seconds</option>
                            <option value="45">45 seconds</option>
                            <option value="60">1 minute</option>
                            <option value="90">1.5 minutes</option>
                            <option value="120">2 minutes</option>
                          </select>
                        </label>

                        <label class="setting-row qp-setting" data-accent="guess">
                          <span class="setting-label">Guess timer</span>
                          <select class="input setting-select" id="qp-guess-timer">
                            <option value="0" selected>‚àû (no limit)</option>
                            <option value="30">30 seconds</option>
                            <option value="45">45 seconds</option>
                            <option value="60">1 minute</option>
                            <option value="90">1.5 minutes</option>
                            <option value="120">2 minutes</option>
                            <option value="180">3 minutes</option>
                          </select>
                        </label>
                      </div>



                      <div class="hint" id="quick-settings-status">Changes apply immediately (no agreement step).</div>

                      <div class="qp-neg-actions" style="margin-top: 14px;">
                        <button class="btn primary qp-neg-btn" id="quick-settings-offer" type="button" disabled>Apply</button>
                      </div>

                    </div>


                  </div>

                </div>
              </div>
            </div>

            <!-- Tournament Lobby -->
            <div id="tournament-lobby" style="display:none;">
              <div class="lobby-header">
                <h2>Play</h2>
              </div>
              <p class="subtitle small">Challenge another team or accept incoming challenges.</p>

              <!-- Your Team Status -->
              <div class="game-team-status" id="game-team-status">
                <div class="hint">You need to be on a team to play in tournaments.</div>
              </div>

              <!-- Active Game Banner -->
              <div class="game-active-banner" id="game-active-banner" style="display:none;">
                <div class="game-banner-info">
                  <span class="game-banner-title">Game in progress</span>
                  <span class="game-banner-teams" id="game-banner-teams"></span>
                </div>
                <button class="btn primary" id="rejoin-game-btn" type="button">Rejoin Game</button>
              </div>

              <!-- Active Games (Spectate / Join) -->
              <div class="game-section" id="active-games-section" style="display:none;">
                <div class="game-section-title">Active Games</div>
                <div class="active-games-list" id="active-games-list"></div>
              </div>

              <!-- Incoming Challenges -->
              <div class="game-section" id="challenges-section" style="display:none;">
                <div class="game-section-title">Incoming Challenges</div>
                <div class="challenges-list" id="challenges-list"></div>
              </div>

              <!-- Challenge -->
              <div class="game-section" id="challenge-teams-section" style="display:none;">
                <div class="game-section-title">Challenge a Team</div>
                <div class="challenge-teams-list" id="challenge-teams-list"></div>
              </div>

              <!-- Pending Challenges You Sent -->
              <div class="game-section" id="pending-challenges-section" style="display:none;">
                <div class="game-section-title">Pending Challenges</div>
                <div class="pending-challenges-list" id="pending-challenges-list"></div>
              </div>
            </div>

            <!-- Game Board View (shown during active game) -->
            <div id="game-board-container" class="game-container-expanded" style="display:none;">

              <!-- Enhanced Game Header with Timer -->
              <div class="game-header-expanded">
                <div class="game-topbar">
                  <div class="topbar-team topbar-team-red">
                    <div class="topbar-team-names" id="topbar-red-names"></div>
                  </div>

                  <div class="topbar-center">
                    <div class="topbar-score" aria-label="Score">
                      <span class="topbar-score-num red" id="game-red-left">9</span>
                      <span class="topbar-score-sep">v</span>
                      <span class="topbar-score-num blue" id="game-blue-left">8</span>
                    </div>

                    <div class="game-timer-display topbar-timer" id="game-timer" style="display:none;">
                      <div class="timer-bar">
                        <div class="timer-fill" id="timer-fill"></div>
                      </div>
                      <span class="timer-text" id="timer-text">0:00</span>
                    </div>
                  </div>

                  <div class="topbar-team topbar-team-blue">
                    <div class="topbar-team-names" id="topbar-blue-names"></div>
                  </div>
                </div>

                <!-- Legacy header fields still referenced by game logic -->
                <div class="game-header-meta" aria-hidden="true">
                  <span class="sr-only" id="game-red-team"></span>
                  <span class="sr-only" id="game-blue-team"></span>
                  <span class="sr-only" id="game-turn-team"></span>
                  <span class="sr-only" id="game-turn-role"></span>
                </div>
              </div>

              <!-- Main Game Layout - 3 Column on Desktop -->
              <div class="game-main-layout">

                <!-- Left Sidebar - Clue History & Game Log -->
                <div class="game-sidebar game-sidebar-left">
                  <!-- Clue History -->
                  <div class="sidebar-panel clue-history-panel">
                    <div class="sidebar-panel-header">
                      <span class="sidebar-panel-title">Clue History</span>
                    </div>
                    <div class="clue-history-content" id="clue-history-list"></div>
                  </div>

                  <!-- Game Log (Desktop) -->
                  <div class="sidebar-panel game-log-panel" id="desktop-game-log-panel">
                    <div class="sidebar-panel-header">
                      <span class="sidebar-panel-title">Game Log</span>
                    </div>
                    <div class="game-log-entries" id="game-log-entries-sidebar"></div>
                  </div>
                </div>

                <!-- Center - Game Board -->
                <div class="game-center-area">
                  <!-- Role Selection (before game starts for player) -->
                  <div class="role-selection-compact" id="role-selection" style="display:none;">
                    <div class="role-buttons-compact">
                      <button class="btn role-btn-compact" id="role-spymaster" type="button">
                        <span class="role-icon">üïµÔ∏è</span>
                        <span class="role-info">
                          <span class="role-name">Spymaster</span>
                          <span class="role-desc">Give clues</span>
                        </span>
                      </button>
                      <button class="btn role-btn-compact" id="role-operative" type="button">
                        <span class="role-icon">üîç</span>
                        <span class="role-info">
                          <span class="role-name">Operative</span>
                          <span class="role-desc">Guess words</span>
                        </span>
                      </button>
                    </div>
                    <div class="role-status" id="role-status"></div>
                  </div>

                  <!-- Game Board -->
                  <div class="game-board-wrapper">
                    <div class="game-board" id="game-board">
                      <!-- 5x5 grid of cards will be generated here -->
                    </div>
                  </div>

                  <!-- Card Tagging Legend (for operatives) -->
                  <div class="card-tag-legend" id="card-tag-legend" style="display:none;">
                    <span class="tag-legend-title">Mark cards:</span>
                    <div class="tag-legend-items">
                      <button class="tag-btn tag-yes" data-tag="yes" title="Likely correct">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                      </button>
                      <button class="tag-btn tag-maybe" data-tag="maybe" title="Maybe">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                      </button>
                      <button class="tag-btn tag-no" data-tag="no" title="Avoid">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                      </button>
                      <button class="tag-btn tag-clear" data-tag="clear" title="Clear tags">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                      </button>
                    </div>
                    <span class="tag-legend-hint">Click a mark, then click cards</span>
                  </div>

                  <!-- Action Bar -->
                  <div class="game-action-bar">
                    <!-- Clue Display -->
                    <div class="clue-display-expanded" id="current-clue" style="display:none;">
                      <span class="clue-label">Clue:</span>
                      <span class="clue-word-expanded" id="clue-word"></span>
                      <span class="clue-number-expanded" id="clue-number"></span>
                      <span class="guesses-left-expanded" id="guesses-left"></span>
                    </div>

                    <!-- Mobile Quick Actions (shown on mobile, right above the clue input) -->
                    <div class="mobile-game-actions" id="mobile-game-actions" aria-label="Game panels">
                      <button class="btn-icon" id="toggle-left-sidebar" type="button" title="Clue History">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/><line x1="8" y1="7" x2="16" y2="7"/><line x1="8" y1="11" x2="16" y2="11"/></svg>
                      </button>
                      <button class="btn-icon" id="toggle-right-sidebar" type="button" title="Team Chat">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                      </button>
                      <button class="btn-icon" id="mobile-players-popup-btn" type="button" title="Players">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                      </button>
                    </div>

                    <!-- Spymaster Clue Input -->
                    <form class="clue-form-expanded" id="clue-form" style="display:none;">
                      <input type="text" class="input clue-input-expanded" id="clue-input" placeholder="Enter your clue..." required />
                      <input type="number" class="input clue-num-expanded" id="clue-num-input" min="0" max="9" placeholder="#" required />
                      <button type="submit" class="btn primary">Give Clue</button>
                    </form>

                    <!-- Operative Actions -->
                    <div class="operative-actions-expanded" id="operative-actions" style="display:none;">
                      <button class="btn" id="end-turn-btn" type="button">End Turn</button>
                    </div>

                    <!-- Waiting Message -->
                    <div class="waiting-expanded" id="waiting-message" style="display:none;">
                      Waiting for <span id="waiting-for"></span>...
                    </div>
                  </div>
                </div>

                <!-- Right Sidebar - Operative Chat & Voting -->
                <div class="game-sidebar game-sidebar-right">
                  <!-- Operative Team Chat -->
                  <div class="sidebar-panel operative-chat-panel">
                    <div class="sidebar-panel-header">
                      <span class="sidebar-panel-title">Team Chat</span>
                      <span class="chat-privacy-badge" id="chat-privacy-badge">Operatives Only</span>
                    </div>
                    <div class="operative-chat-messages" id="operative-chat-messages">
                      <div class="chat-empty-state">No messages yet. Discuss with your team!</div>
                    </div>
                    <form class="operative-chat-form" id="operative-chat-form">
                      <input type="text" class="input chat-input" id="operative-chat-input" placeholder="Message your team..." autocomplete="off" />
                      <button type="submit" class="btn primary chat-send-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                      </button>
                    </form>
                  </div>

                                  </div>
              </div>

              <!-- Players Popup (Mobile) -->
              <div class="players-popup" id="players-popup" style="display:none;" role="dialog" aria-modal="true" aria-label="Players">
                <div class="players-popup-backdrop" id="players-popup-backdrop"></div>
                <div class="players-popup-card">
                  <div class="players-popup-header">
                    <span class="players-popup-title">Players</span>
                    <button class="btn-icon btn-close-popover" id="players-popup-close" type="button" aria-label="Close">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                  </div>
                  <div class="players-popup-body">
                    <div class="players-popup-team red">
                      <div class="players-popup-team-title"><span class="dot red"></span>Red</div>
                      <div class="players-popup-list" id="players-popup-red"></div>
                    </div>
                    <div class="players-popup-team blue">
                      <div class="players-popup-team-title"><span class="dot blue"></span>Blue</div>
                      <div class="players-popup-list" id="players-popup-blue"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Mobile Sidebar Backdrop -->
              <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
            </div>
          </div>
        </section>
      </main>

      <!-- Mobile Tabs -->
      <nav class="mobile-tabs">
        <button class="tab" data-panel="panel-home" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
          <span>Home</span>
        </button>
        <button class="tab" data-panel="panel-teams" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>Teams</span>
        </button>
        <button class="tab" data-panel="panel-players" type="button">
          <!-- Single-person icon to differentiate from Teams on mobile -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          <span>Players</span>
        </button>
        <button class="tab" data-panel="panel-myteam" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
          <span>My Team</span>
          <span class="badge tab-badge" id="badge-myteam-mobile" aria-label="Team notifications" style="display:none;"></span>
        </button>
        <button class="tab active" data-panel="panel-game" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M12 12h.01"/><path d="M17 12h.01"/><path d="M7 12h.01"/></svg>
          <span>Play</span>
          <span class="badge tab-badge" id="badge-game-mobile" aria-label="Active games" style="display:none;"></span>
        </button>
      </nav>

      <!-- Team Modal -->
      <div class="modal" id="team-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-card">
          <div class="modal-head">
            <div class="modal-title" id="team-modal-title">Team</div>
            <button class="icon-btn" id="team-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <div class="team-section-title">Members</div>
            <div class="players-list" id="team-modal-members"></div>
            <div class="form-actions" style="margin-top:12px;">
              <button class="btn primary" id="team-modal-join" type="button">Request to join</button>
              <span class="hint" id="team-modal-hint"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Requests Modal (Owner) -->
      <div class="modal" id="requests-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-card">
          <div class="modal-head">
            <div class="modal-title">Team requests</div>
            <button class="icon-btn" id="requests-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <div class="team-section-title">Pending</div>
            <div id="requests-modal-list"></div>
            <div class="hint" id="requests-modal-hint" style="margin-top:10px;"></div>
          </div>
        </div>
      </div>

      <!-- Invites Modal -->
      <div class="modal" id="invites-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-card">
          <div class="modal-head">
            <div class="modal-title">Invites</div>
            <button class="icon-btn" id="invites-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <div id="invites-modal-list"></div>
            <div class="hint" id="invites-modal-hint" style="margin-top:10px;"></div>
          </div>
        </div>
      </div>

      <!-- (chat lives in its own tab now) -->

      <!-- Create Team Modal -->
      <div class="modal" id="create-team-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-card">
          <div class="modal-head">
            <div class="modal-title">Create a team</div>
            <button class="icon-btn" id="create-team-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <form id="create-team-form" class="form">
              <label class="field">
                <span class="label">Team name</span>
                <input type="text" id="create-teamName" class="input" placeholder="e.g., Night Owls" required>
              </label>
              <label class="field">
                <span class="label">Team color</span>
                <div class="color-picker-row">
                  <input type="color" id="create-teamColor" class="color-input" value="#3b82f6" aria-label="Team color" />
                  <span class="hint">Used for a subtle glow + highlights.</span>
                </div>
              </label>
              <div class="form-actions">
                <button type="submit" class="btn primary" id="create-team-submit">Create team</button>
                <span class="hint" id="create-team-hint"></span>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Online Users Modal -->
      <div class="modal online-modal" id="online-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="online-modal-backdrop"></div>
        <div class="modal-card online-modal-card">
          <div class="modal-head">
            <div class="modal-title">Who's Online</div>
            <button class="icon-btn" id="online-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body online-modal-body">
            <div class="online-tabs" role="tablist" aria-label="Online users filter">
              <button class="online-tab active" id="online-tab-everyone" type="button" role="tab" aria-selected="true">Everyone</button>
              <button class="online-tab" id="online-tab-teammates" type="button" role="tab" aria-selected="false">Teammates</button>
            </div>
            <div class="subtitle small" id="online-status-legend"></div>
            <div class="online-users-list" id="online-users-list"></div>
          </div>
        </div>
      </div>

      <!-- Profile Details Modal -->
      <div class="modal profile-details-modal" id="profile-details-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="profile-details-backdrop"></div>
        <div class="modal-card settings-modal-card profile-details-modal-card">
          <div class="modal-head">
            <div class="modal-title" id="profile-details-title">Details</div>
            <button class="icon-btn" id="profile-details-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body settings-modal-body" id="profile-details-body"></div>
        </div>
      </div>

      <!-- Change Name Modal -->
      <div class="modal name-change-modal" id="name-change-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="name-change-modal-backdrop"></div>
        <div class="modal-card name-change-modal-card">
          <div class="modal-head">
            <div class="modal-title">Change Name</div>
            <button class="icon-btn" id="name-change-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <form id="name-change-form" class="form">
              <label class="field">
                <span class="label">New name</span>
                <input type="text" id="name-change-input" class="input" placeholder="new_name" autocapitalize="off" autocomplete="off" required>
              </label>
              <div class="hint" id="name-change-hint">3‚Äì20 chars (a‚Äìz, 0‚Äì9, _)</div>
              <div class="form-actions">
                <button type="submit" class="btn primary">Update</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Change Password Modal -->
      <div class="modal password-change-modal" id="password-change-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="password-change-modal-backdrop"></div>
        <div class="modal-card password-change-modal-card">
          <div class="modal-head">
            <div class="modal-title">Change password</div>
            <button class="icon-btn" id="password-change-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <form id="password-change-form" class="form">
              <label class="field">
                <span class="label">Current password</span>
                <input type="password" id="password-current-input" class="input" placeholder="Current password" autocomplete="current-password" required>
              </label>
              <label class="field">
                <span class="label">New password</span>
                <input type="password" id="password-new-input" class="input" placeholder="New password" autocomplete="new-password" required>
              </label>
              <label class="field">
                <span class="label">Confirm new password</span>
                <input type="password" id="password-confirm-input" class="input" placeholder="Confirm new password" autocomplete="new-password" required>
              </label>
              <div class="hint" id="password-change-hint"></div>
              <div class="form-actions">
                <button type="submit" class="btn primary">Update password</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Teammates Modal -->
      <div class="modal teammates-modal" id="teammates-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="teammates-modal-backdrop"></div>
        <div class="modal-card teammates-modal-card">
          <div class="modal-head">
            <div class="modal-title" id="teammates-modal-title">My Team</div>
            <button class="icon-btn" id="teammates-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <div class="teammates-list" id="teammates-modal-list"></div>
            <div class="hint" id="teammates-modal-hint"></div>
          </div>
        </div>
      </div>

            <!-- Settings Modal -->
      <div class="modal settings-modal" id="settings-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="settings-modal-backdrop"></div>
        <div class="modal-card settings-modal-card">
          <div class="modal-head">
            <div class="modal-title">Settings</div>
            <button class="icon-btn" id="settings-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body settings-modal-body">
            <div class="settings-simple">
              <label class="settings-row">
                <span class="settings-row-label">Animations</span>
                <div class="toggle-switch">
                  <input type="checkbox" id="settings-animations-toggle" checked />
                  <span class="toggle-slider"></span>
                </div>
              </label>

<label class="settings-row">
  <span class="settings-row-label">Light mode</span>
  <div class="toggle-switch">
    <input type="checkbox" id="settings-theme-toggle" />
    <span class="toggle-slider"></span>
  </div>
</label>

              <div class="settings-row settings-row-volume">
                <span class="settings-row-label">Volume</span>
                <input type="range" id="settings-volume-slider" class="settings-volume-slider" min="0" max="100" value="70" />
                <span class="settings-volume-value" id="settings-volume-value">70%</span>
              </div>

              <div class="settings-account-actions">
                <button class="btn" id="settings-change-name-btn" type="button">Change Name</button>
                <button class="btn" id="settings-change-password-btn" type="button">Change Password</button>
                <button class="btn" id="settings-logout-btn" type="button">Log Out</button>
              </div>

              <div class="settings-danger" id="settings-danger">
                <div class="settings-danger-actions">
                  <button class="btn danger" id="settings-delete-account-btn" type="button">Delete Account</button>
                </div>
                <div class="hint" id="settings-delete-account-hint" style="display:none;"></div>
              </div>

              <!-- Admin Actions (visible to everyone; disabled unless admin) -->
              <div class="settings-admin" id="settings-admin">
                <div class="settings-section-title">Admin</div>
                <div class="settings-admin-actions">
                  <button class="settings-row settings-row-action" id="admin-backup-now-btn" type="button">
                    <span class="settings-row-label">Backup Teams/Players Now</span>
                    <span class="settings-row-meta">Admin</span>
                  </button>
                  <button class="settings-row settings-row-action" id="admin-logs-btn" type="button">
                    <span class="settings-row-label">Logs</span>
                    <span class="settings-row-meta">Admin</span>
                  </button>
                  <button class="settings-row settings-row-action" id="admin-restore-5min-btn" type="button">
                    <span class="settings-row-label">Restore Teams/Players (5 min ago)</span>
                    <span class="settings-row-meta">Admin</span>
                  </button>
                </div>
                <div class="hint" id="admin-restore-hint" aria-live="polite"></div>
              </div>

              <!-- In-Game Actions (shown whenever a user is in an active game) -->
              <div class="settings-in-game-actions" id="settings-in-game-actions" style="display:none;">
                                <div class="settings-account-actions">
                  <button class="btn" id="leave-game-btn" type="button">Leave Game</button>
                  <button class="btn danger" id="end-game-btn" type="button">End Game</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Popup (Team & Player) -->
      <div class="profile-popup" id="profile-popup" style="display:none;">
        <div class="profile-popup-card">
          <div class="profile-popup-header">
            <div class="profile-popup-title" id="profile-popup-title">Name</div>
            <button class="icon-btn profile-popup-close" id="profile-popup-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="profile-popup-body" id="profile-popup-body">
            <!-- Content loaded dynamically -->
          </div>
        </div>
      </div>
      <div class="profile-popup-backdrop" id="profile-popup-backdrop" style="display:none;"></div>

      <!-- Admin Logs Popup (admin-only) -->
      <div class="profile-popup logs-popup" id="logs-popup" style="display:none;">
        <div class="profile-popup-card logs-popup-card">
          <div class="profile-popup-header">
            <div class="profile-popup-title">Logs</div>
            <button class="icon-btn profile-popup-close" id="logs-popup-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="profile-popup-body">
            <div class="logs-subtitle" id="logs-subtitle">Live activity (updates in real time)</div>
            <div class="logs-list" id="logs-list"></div>
            <div class="hint" id="logs-hint" style="min-height: 18px;"></div>
          </div>
        </div>
      </div>
      <div class="profile-popup-backdrop" id="logs-popup-backdrop" style="display:none;"></div>

      <!-- Change Password Modal -->
      <div class="modal password-change-modal" id="password-change-modal" style="display:none;" role="dialog" aria-modal="true">
        <div class="modal-backdrop" id="password-change-modal-backdrop"></div>
        <div class="modal-card password-change-modal-card">
          <div class="modal-head">
            <div class="modal-title">Change Password</div>
            <button class="icon-btn" id="password-change-modal-close" type="button" aria-label="Close">√ó</button>
          </div>
          <div class="modal-body">
            <form id="password-change-form" class="form">
              <label class="field">
                <span class="label">Current password</span>
                <input type="password" id="password-change-current" class="input" autocomplete="current-password" required>
              </label>
              <label class="field">
                <span class="label">New password</span>
                <input type="password" id="password-change-new" class="input" autocomplete="new-password" required>
              </label>
              <label class="field">
                <span class="label">Confirm new password</span>
                <input type="password" id="password-change-confirm" class="input" autocomplete="new-password" required>
              </label>
              <div class="hint" id="password-change-hint" style="min-height: 18px;"></div>
              <div class="form-actions">
                <button type="submit" class="btn primary">Update password</button>
              </div>
            </form>
          </div>
        </div>
      </div>


    </div>

    <!-- Quick Play Gate (shown if a live game is already in progress) -->
    <div class="qp-gate hidden" id="qp-gate" role="dialog" aria-modal="true" aria-label="Live game options">
      <div class="qp-gate-card">
        <div class="qp-gate-title">A live game is in progress</div>
        <div class="qp-gate-sub" id="qp-gate-status">Live game detected</div>
        <div class="qp-gate-actions">
          <button class="btn primary" id="qp-gate-rejoin" type="button">Rejoin</button>
          <button class="btn" id="qp-gate-spectate" type="button">Spectate Game</button>
          <button class="btn logout" id="qp-gate-back" type="button">Back to Homepage</button>
        </div>
      </div>
    </div>


<!-- Messages Drawer (Global / Team / Personal) -->
<div class="drawer-backdrop" id="chat-drawer-backdrop" style="display:none;"></div>
<aside class="drawer chat-drawer" id="chat-drawer" aria-hidden="true">
  <div class="drawer-header">
    <div class="drawer-title">Messages</div>
    <button class="icon-btn" id="chat-drawer-close" type="button" aria-label="Close">√ó</button>
  </div>

  <div class="drawer-body">
    <div class="segmented" role="tablist" aria-label="Chat mode">
      <button class="seg-btn active" id="chat-mode-global" type="button" role="tab" aria-selected="true">
        Global
        <span class="badge seg-badge" id="badge-global" aria-label="Unread global messages" style="display:none;"></span>
      </button>
      <button class="seg-btn" id="chat-mode-team" type="button" role="tab" aria-selected="false">
        Team
        <span class="badge seg-badge" id="badge-team" aria-label="Unread team messages" style="display:none;"></span>
      </button>
      <button class="seg-btn" id="chat-mode-personal" type="button" role="tab" aria-selected="false">
        Personal
      </button>
    </div>

    <div class="chat-card drawer-chat-card">

      <div class="dm-inbox" id="dm-inbox" style="display:none;">
        <div class="dm-inbox-header">
          <button class="btn subtle dm-new-btn dm-inbox-title-btn" id="dm-inbox-new" type="button">New</button>
        </div>
        <div class="dm-thread-list" id="dm-thread-list"></div>
      </div>

      <div class="dm-thread-bar" id="dm-thread-bar" style="display:none;">
        <button class="icon-btn dm-back-btn" id="dm-back-btn" type="button" aria-label="Back">‚Äπ</button>
        <div class="dm-thread-title" id="dm-thread-title">‚Äî</div>
        <button class="btn subtle dm-new-btn" id="dm-thread-new" type="button">New</button>
      </div>

      <div class="dm-new-popover" id="dm-new-popover" style="display:none;" role="dialog" aria-modal="true" aria-label="New message">
        <div class="dm-new-header">
          <div class="dm-new-title">New Message</div>
          <button class="icon-btn" id="dm-new-close" type="button" aria-label="Close">√ó</button>
        </div>
        <input class="input dm-new-search" id="dm-new-search" type="text" placeholder="Search people" autocomplete="off" />
        <div class="dm-new-list" id="dm-new-list" role="listbox" aria-label="People"></div>
      </div>

      <div class="chat-messages" id="chat-panel-messages"></div>

      <form class="chat-compose" id="chat-panel-form">
        <input class="input chat-input" id="chat-panel-input" type="text" placeholder="Message" autocomplete="off" />
        <button class="btn primary chat-send" id="chat-panel-send" type="submit">Send</button>
      </form>

      <div class="hint" id="chat-panel-hint"></div>
    </div>
  </div>
</aside>




    <!-- AI Mode Selection Modal -->
    <div class="modal ai-mode-modal" id="ai-mode-modal" style="display:none;" role="dialog" aria-modal="true" aria-label="Add AI Player">
      <div class="modal-backdrop" id="ai-mode-modal-backdrop"></div>
      <div class="modal-card ai-mode-modal-card">
        <div class="modal-head">
          <div class="modal-title">Add AI Player</div>
          <button class="icon-btn" id="ai-mode-modal-close" type="button" aria-label="Close">√ó</button>
        </div>
        <div class="modal-body">
          <div class="ai-mode-subtitle" id="ai-mode-subtitle">Choose AI mode</div>
          <div class="ai-mode-cards">
            <button class="ai-mode-card" id="ai-mode-helper" type="button">
              <div class="ai-mode-icon">üí¨</div>
              <div class="ai-mode-title">AI Helper</div>
              <div class="ai-mode-desc">Chats strategy, reacts to cards, and helps the team discuss. Never selects cards or gives clues.</div>
            </button>
            <button class="ai-mode-card" id="ai-mode-autonomous" type="button">
              <div class="ai-mode-icon">ü§ñ</div>
              <div class="ai-mode-title">AI Autonomous</div>
              <div class="ai-mode-desc">Fully plays the game: reasons aloud, gives clues, picks cards, and has its own opinions.</div>
            </button>
          </div>
          <div class="ai-mode-status" id="ai-mode-status"></div>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
    <script src="game.js"></script>
    <script src="ai-player.js"></script>
  </body>
</html>